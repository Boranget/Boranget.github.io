---
title: 计算机网络
date: 2024-03-04 10:35:19
updated: 2024-03-04 10:35:19
tags:
  - 计算机网络
categories:
  - 笔记
---

# 概论

构成：节点与边，节点包括主机节点与数据交换节点，边包括接入链路和骨干链路，还有协议

互联网是网络的网络，是分布式的应用以及为分布式应用提供服务的基础设施组成

基础设置提供两种服务，一种是面向连接的，一种是不面向连接的

## 网络边缘

主机与应用，构成了边缘系统，通过access接入核心。

网络边缘、接入网以及网络核心为互联网的三个子系统。

- tcp面向连接
    - 需要建立连接
    - 可靠，不丢失，不乱序，流量控制与拥塞控制
    - http、ftp、telnet、smtp
- udp无连接
    - 无需建立连接
    - 不可靠，无流量控制，无拥塞控制
    - 流媒体、远程会议、dns、网络电话

## 网络核心

全球范围内的数据交换

- 电路交换

    - 不共享，分配后若无数据交换会被浪费
    - 性能有保障
    - 被传统电话网络使用
    - 分片大小固定
    - 频分、时分

- 分组交换

    - 存储转发

    - 线路可以共享，不会占用整个链路

    - 使用存储排队换取共享性

    - 如果路由器缓存用完了会被丢弃

    - 分片大小按需分配

    - 转发方式：数据报（无连接）、虚电路（有连接）

        这里的有连接与tcp的面向连接不同，tcp的连接仅体现在tcp层，中间的设施不维护他们的连接状态

## 接入网

接入方式

- 调制解调器：电信运营商的电话线，可通过频分进行上下行带宽的区分
- 调制解调器：有线电视公司的同轴电缆
- 调制解调器：电力公司的电线

物理媒体

- 导引型媒体

    看得见摸得着的

    - 双绞线
    - 同轴电缆
    - 光缆，全反射

- 非导引型

    - 地面微波
    - wifi
    - 蜂窝
    - 卫星

## ISP

端系统通过接入isp接入到互联网

isp之间相互合作，达到可以互相访问的目的，同时避免耗时对接对方的端系统 

中心：第一层ISP，直接与其他ISP项链，与大量的第二层ISP相连，连接点相对少，但是带宽极高

第二层：区域性ISP

第三层：本地ISP

## 分组延时与丢失

### 延时

- 处理延时

    存储转发延时

- 排队延时

    路由器会有队列，排队会有延迟，超出队列容量会被丢失

    取决于流量强度，流量强度为1时延时无穷大 

- 传输延时

    将分组发送到链路上的时间

- 传播延时

    在媒介上传播的时间

### traceroute/tracert

原理：使用ICMP控制报文头中的ttl字段（生存时间）

ttl字段过一个路由器的时候减一，ttl为0时会被丢弃，然后返回控制报文

### 吞吐量

单位时间内，单位时间从源主机向目标主机放出的有效数据量

## 协议层次与服务模型

分层，每层实现更简单，可以拆分为功能明确的层次

每一层次通过接口向上层提供服务

服务访问点：下层服务如何判断是哪个上层用户的报文

上层使用下层提供的服务的形式：原语 

面向连接：请求前先握手，为接下来的请求做好准备

无连接：不握手，不准备，直接请求

服务是垂直的，在一个系统内部相邻两层之间的关系

协议是在不同系统直接，同一层中的关系

### 数据单元

上层来的sdu加上本层的头变成本层的pdu

或者将多个sdu合道一个pdu中

或者将一个pdu拆到多个pdu中

### internet协议栈

五层：

- 应用层
- 传输层
    进程到进程，tcp服务中将不可靠的转为可靠的
- 网络层
    传输以分组为单位的数据，端到端
- 链路层
    将比特分成一个个帧，相邻两点之间传输以帧为单位的数据，比如端到交换机
- 物理层
    将上层交下来的比特转为物理信号并传输，或者反过来交给链路层

OSI七层

应用下多了表示层与会话层，这两层在五层中是在应用层里的

- 表示层
    加密压缩
- 会话层
    会话管理

各层的数据单元：

- 应用层：报文message
- 传输层：报文段segment-TCP段orUDP数据报
- 网络层：分组packet or 无连接数据报datagram
- 数据链路层：帧 frame
- 物理层：位 bit  

# 应用层

## 应用架构

- CS模式
- P2P模式
- 混合模式

## 进程标识与寻址

进程：端口号

主机：ip

## 穿过层间的信息

发送方、接收方、信息体

为了避免每次都传输全部信息，减少信息传输量，增加了socket机制

socket：socket其实就是一个整数，这个整数对应着传输信息（tcp：【发送方ip、端口号、接收方ip、端口号】udp：【发送方ip、端口号】），之后直接通过socket来发送信息。socket是应用层与传输层之间的约定，与其他层无关。

tcp中的socket是一种会话关系，而不是标识。在同一个端口上可以建立多个socket，也就是多个会话。

在udp中是无连接的，故在udp中，socket不代表会话，只代表本地ip和本地端口，所以在udp中，应用层每次要向传输层传三样东西：传输内容、socket、对方地址（ip和端口号）

## Web与HTTP

URL 通用资源定位符

`协议://用户:口令@主机名/路径:端口`

http 超文本传输协议，基于TCP，http无状态，服务器不维护客户的信息

服务器启动时会创建一个守护socket，每当来一个请求都会新建一个socket，守护socket继续守护在端口上

HTTP 1.0 非持久HTTP 一次请求与响应之后关闭连接

HTTP 2.0 持久HTTP 一次请求与响应后先不关闭连接 

```
GET  /a/a.html HTTP/1.1
Host: ...
User-agent: Mozilla/4.0
body
(一个额外的回车代表报文结束)


HTTP/1.1 200 OK\r\n
Connection close\r\n
头\r\n
\r\n
\r\n
data

```

cookie：保存状态的一种策略

cache：访问代理服务器中的缓存，没有则访问原始服务器

检查缓存是否更新：增加一个头部`if-modified-since`，询问服务器是否更新，服务器响应304则为没有修改

## FTP

服务端守护在21端口，上传下载文件，CS模式，基于TCP协议，有状态协议

客户端向服务端发起tcp连接建立，叫做控制连接，用于发送命令，命令以ASCII编码

- USER username
- PASS password
- LIST 要求服务器返回文件列表
- RETR filename 下载
- STOR filename 上传

返回状态码：

331 Username OK,password required

125 data connection already open transfer staring

425 can't opendata connection

452 error writing file

服务端向客户端发起tcp连接接案例，叫做数据连接，用于传输文件，指定客户端端口号为20

## EMAIL

角色

- 用户代理
    撰写邮件的软件，比如outlook，网易邮箱大师，用户代理配置好邮件服务器的ip与端口号，将邮件发送到邮件服务器的队列中。客户代理从邮件服务器中将邮箱中的邮件拉取回来。

- 邮件服务器
    守护在25号端口，收到用户代理发过来的邮件后，将其使用smtp发送到对应的邮件服务器，邮件服务器收到其他邮件服务器发来的邮件后，将其保存到对应用户的邮件列表中，也就是收件箱

smtp，基于tcp

- 阶段：握手、传报文（多个邮件会一起发，而不会等连接关闭后重新连接）、关闭
- 命令和响应报文都是ascii形式，报文必须是7位ascii形式
- 使用持久连接，报文使用CRLF

```
首部：
To:
From:
Subject:
主体：
报文：只能是ASCII字符
```

mime multimedia mail extension 多媒体邮件扩展

在报文首部额外声明MIME内容类型

```
首部：
To:
From:
Subject:
MIME_Version:1.0
Content_Transfer_Encoding: base64
Content-Type: image/jpeg
主体：
报文：只能是ASCII字符,base64编码后的图片
```

邮件接收协议

- pop/pop3 邮局访问协议 post office protocol
    用户身份确认并下载，只能区分收发件箱，无状态
    - 命令：
        - user
        - pass
        - list 报文号列表
        - retr 根据报文号检索报文
        - dele 删除
        - quit
    - 响应
        - +OK
        - -ERR
    - 模式
        - 下载并删除：邮件服务器不会保留已被拉取的邮件，省空间
        - 下载并保留：会保留，其他客户端也可以看到
- imap internet 邮件访问协议
    更多特性，运行邮件目录的创建与维护，邮件的移动等，会维护用户状态
- http 

## DNS

域名到ip的转换

域名是应用层使用的，传输层需要ip地址，所以dns只是获取ip，而不是代理发送请求

分层命名，分布式数据库，运行在udp 53端口

设备名翻译、负载均衡

**根名字服务器**

互联网有13个根服务器，中国大陆没有

根服务器并不是对应的一个顶级域名，而是维护各种顶级域名的域名解析服务器的地址

顶级域（TLD）服务器，负责顶级域名

从树根开始找顶级域，顶级域中找二级域……

域的域名，主机的域名，域域名下面可以继续分配给主机

区域（zone）：将名称空间分为一个个区域，区域之前相互不交织，每个区域中有一个命名服务器

区域域名服务器维护资源记录

- 维护域名和ip或者其他信息的映射关系
- 存储在name server的分布式数据库中

- RR格式：域名，ttl（生存时间，缓存的记录存活时间少，权威域名存活时间长），class（对与Internet，值为IN，说明还有非网络的服务），value，type
    - type：
        - A name为主机，value为IP地址
        - CNAME name为规范名字的别名，value为规范名字
        - NS name为域名，value为该域名的权威服务器的域名
        - MX value为name对应的邮件服务器的名字

本地名字服务器 local name server 

 dns查询与响应报文（相同）结构：

- id，用于标识响应与哪个记录对应
-  flags
    - 查询/应答
    - 希望递归
    - 递归可用
    - 应答为权威
- ……

当一个name server 学到了一条记录会将其缓存，默认2天

## P2P

 不会随着节点的增加而导致网络拥塞

